{% macro warnings(warnings) -%}
    <div>
        {% for warning in warnings %}
            <!-- Trigger the modal with a button -->
            {% if warning.level == 0 %}
                <button type="button" class="btn btn-success btn-lg alert alert-success" data-toggle="modal" data-target="#issue{{ loop.index }}">
            {% elif warning.level == 1 %}
                <button type="button" class="btn btn-warning btn-lg alert alert-warning" data-toggle="modal" data-target="#issue{{ loop.index }}">
            {% elif warning.level == 2 %}
                <button type="button" class="btn btn-danger btn-lg alert alert-danger" data-toggle="modal" data-target="#issue{{ loop.index }}">
            {% endif %}
            {{ warning.text }}
            </button>

            <!-- Modal -->
            <div id="issue{{ loop.index }}" class="modal fade" role="dialog">
              <div class="modal-dialog modal-lg">

                <!-- Modal content-->
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">{{ warning.header }}</h4>
                  </div>
                  <div class="modal-body">
                    <p><pre>{{ warning.summary }}</pre></p>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                  </div>
                </div>

              </div>
            </div>
        {% endfor %}
    </div>
{%- endmacro %}

{% extends "report_base.html" %}
{% block content %}
<div class="page-header">
    <h1>{{ page_title }}</h1>
</div>

<div>
    <h2>Merging statistics</h2>

    <p>
        <b>Filename:</b> {{ filename }}
        <br>
        <b>Unit cell:</b> {{ space_group }}
        <br>
        <b>Space group:</b> {{ unit_cell }}
        {% if xtriage_warnings %}
            <br>
            <b>Xtriage issues:</b>
            {{ warnings(xtriage_warnings) }}
        {% endif %}
    </p>

    <div class="panel-group">
        <div class="panel panel-default">
            <div class="panel-heading" data-toggle="collapse" href="#collapse_expt">
                <h4 class="panel-title">
                    <a>Overall</a>
                </h4>
            </div>
            <div id="collapse_expt" class="panel-collapse collapse in">
                <div class="panel-body">
                    <div style="width: 800px">
                        {{ macros.table(overall_stats_table,
                                        has_column_header=true,
                                        has_row_header=true) }}
                    </div>
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading" data-toggle="collapse" href="#collapse_geom">
                <h4 class="panel-title">
                    <a>Resolution shells</a>
                </h4>
            </div>
            <div id="collapse_geom" class="panel-collapse collapse">
                <div class="panel-body">
                    {{ macros.table(merging_stats_table, has_row_header=true) }}
                  *significant at p={{ cc_half_significance_level }}
                </div>
            </div>
        </div>
    </div>
</div>

<div>
    <h2>Analysis plots</h2>

    <div class="panel-group">
        {{ macros.panel('Analysis by resolution', 'resolution', resolution_graphs) }}
        {{ macros.panel('Analysis by batch', 'batch', batch_graphs) }}
        {{ macros.panel('Miscellaneous', 'misc', misc_graphs, styles=styles) }}
    </div>

</div>

{% endblock %}
