{% macro xtriage_results(success, warning, danger) -%}

<div class="panel panel-default">
    <div class="panel-heading" data-toggle="collapse" href="#collapse_xtriage">
        <h4 class="panel-title">
            <a>Xtriage</a>
        </h4>
    </div>
    <div id="collapse_xtriage" class="panel-collapse collapse in">
        <div class="panel-body">
            <div class="panel-group">
                {% if danger %}
                    <div class="panel panel-danger">
                        <div class="panel-heading" data-toggle="collapse" href="#collapse_xtriage_danger">
                            <h4 class="panel-title">
                                <span class="glyphicon glyphicon-remove"></span>
                                <a>{{ danger|length}} serious warning{% if danger|length > 1%}s{% endif %}</a>
                            </h4>
                        </div>
                        <div id="collapse_xtriage_danger" class="panel-collapse collapse in">
                            <div class="panel-body">
                                {% for issue in danger %}
                                    <button type="button" class="btn btn-danger btn-block" style="text-align:left; padding-left:6px" data-toggle="modal" data-target="#danger{{ loop.index }}">
                                    <span class="glyphicon glyphicon-remove"></span>
                                    {{ issue.text }}
                                    </button>
                                {{ xtriage_modal(issue.header, issue.summary, "danger"+loop.index|string)}}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}
                {% if warning %}
                    <div class="panel panel-warning">
                        <div class="panel-heading" data-toggle="collapse" href="#collapse_xtriage_warning">
                            <h4 class="panel-title">
                                <span class="glyphicon glyphicon-exclamation-sign"></span>
                                <a>{{ warning|length}} alert{% if warning|length > 1%}s{% endif %}</a>
                            </h4>
                        </div>
                        <div id="collapse_xtriage_warning" class="panel-collapse collapse in">
                            <div class="panel-body">
                                {% for issue in warning %}
                                    <button type="button" class="btn btn-warning btn-block" style="text-align:left; padding-left:6px" data-toggle="modal" data-target="#warning{{ loop.index }}">
                                    <span class="glyphicon glyphicon-exclamation-sign"></span>
                                    {{ issue.text }}
                                    </button>
                                {{ xtriage_modal(issue.header, issue.summary, "warning"+loop.index|string)}}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}
                {% if success %}
                    <div class="panel panel-success">
                        <div class="panel-heading" data-toggle="collapse" href="#collapse_xtriage_success">
                            <h4 class="panel-title">
                                <span class="glyphicon glyphicon-ok"></span>
                                <a>{{ success|length}} check{% if success|length > 1%}s{% endif %} passed</a>
                            </h4>
                        </div>
                        <div id="collapse_xtriage_success" class="panel-collapse collapse">
                            <div class="panel-body">
                                {% for issue in success %}
                                    <button type="button" class="btn btn-success btn-block" style="text-align:left; padding-left:6px" data-toggle="modal" data-target="#success{{ loop.index }}">
                                    <span class="glyphicon glyphicon-ok"></span>
                                    {{ issue.text }}
                                    </button>
                                {{ xtriage_modal(issue.header, issue.summary, "success"+loop.index|string)}}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
            <small>
                Zwart, P. H., Grosse-Kunstleve, R. W. &amp; Adams, P. D. (2005). <i>CCP4 Newsl.</i> <b>43</b>, contribution 7.
            </small>
        </div>
    </div>
</div>

{%- endmacro %}

{% macro xtriage_modal(header, content, id) -%}

<!-- Modal -->
<div id="{{ id }}" class="modal fade" role="dialog">
  <div class="modal-dialog modal-lg">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">{{ header }}</h4>
      </div>
      <div class="modal-body">
        <p><pre>{{ content }}</pre></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>

{%- endmacro %}

{% extends "report_base.html" %}
{% block content %}
<div class="page-header">
    <h1>{{ page_title }}</h1>
</div>

<div>
    <h2>Merging statistics</h2>

    <p>
        <b>Filename:</b> {{ filename }}
        <br>
        <b>Space group:</b> {{ space_group }}
        <br>
        <b>Unit cell:</b> {{ unit_cell }}
    </p>

    <div class="panel-group">

        <div class="panel panel-default">
            <div class="panel-heading" data-toggle="collapse" href="#collapse_history">
                <h4 class="panel-title">
                    <a>MTZ history</a>
                </h4>
            </div>
            <div id="collapse_history" class="panel-collapse collapse">
                <div class="panel-body">
                    <ul class="list-group">
                    {% for item in mtz_history %}
                        <li class="list-group-item">{{ item }}</li>
                    {% endfor %}
                    </ul>
                </div>
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-heading" data-toggle="collapse" href="#collapse_expt">
                <h4 class="panel-title">
                    <a>Overall</a>
                </h4>
            </div>
            <div id="collapse_expt" class="panel-collapse collapse in">
                <div class="panel-body">
                    <div style="width: 800px">
                        {{ macros.table(overall_stats_table,
                                        has_column_header=true,
                                        has_row_header=true) }}
                    </div>
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading" data-toggle="collapse" href="#collapse_geom">
                <h4 class="panel-title">
                    <a>Resolution shells</a>
                </h4>
            </div>
            <div id="collapse_geom" class="panel-collapse collapse">
                <div class="panel-body">
                    {{ macros.table(merging_stats_table, has_row_header=true) }}
                  *significant at p={{ cc_half_significance_level }}
                </div>
            </div>
        </div>
        {% if xtriage_success or xtriage_warnings or xtriage_danger %}
            {{ xtriage_results(xtriage_success, xtriage_warnings, xtriage_danger) }}
        {% endif %}
    </div>
</div>

<div>
    <h2>Analysis plots</h2>

    <div class="panel-group">
        {{ macros.panel('Analysis by resolution', 'resolution', resolution_graphs) }}
        {{ macros.panel('Analysis by batch', 'batch', batch_graphs) }}
        {{ macros.panel('Miscellaneous', 'misc', misc_graphs, styles=styles) }}
    </div>

</div>

{% endblock %}
